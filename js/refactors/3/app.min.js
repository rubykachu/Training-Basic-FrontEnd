// Component 2: Manage event item
define(
	// Define dependencies
	'TodoItem',[],

	function() {
	'use strict';
	function TodoItem(options) {
		this.options = options
	}

	// Render item. Return object html
	TodoItem.prototype.render = function(event) {
		/*jshint multistr:true*/
		var html = '\
		<li class="" data-id="' + this.options.id + '">\
			<div class="view">\
				<input class="toggle" type="checkbox" ">\
				<label>' + this.options.title + '</label>\
				<button class="destroy"></button>\
			</div>\
			<input class="edit" value="' + this.options.title + '">\
		</li>';

		this.$item = $(html);
		// Cần phải truyền bind(this), để có thể sử dụng this trong các function của prototype
		this.$item.on('click', '.destroy', this.destroy.bind(this));
		this.$item.on('change', '.toggle', this.toggle.bind(this));
		return this.$item;
	}

	// Remove a todo item
	TodoItem.prototype.destroy = function(event) {
		// var el = event.target;
		// $(el).closest('li').remove();
		// Nếu khong bind(this) thì this lúc này là element button
		this.$item.remove();
	}

	// Toggle complete
	TodoItem.prototype.toggle = function(event) {
		// var el = event.target;
		// $(el).closest('li').toggleClass('completed');
		this.$item.toggleClass('completed');
	}

	// exports
	return TodoItem;
});

// http://requirejs.org/docs/start.html
// Component 1: Manage AppView
define(
	// Define dependencies
	'AppView',['TodoItem'],

	function(TodoItem) {
	'use strict';
	// constants
	var ENTER_KEY = 13;

	function AppView($el) {
		$el.on('keyup', '#new-todo', this.create);
	}

	// create new todo function
	AppView.prototype.create = function (e) {
		console.log('create()');
		var $input = $(e.target);
		var val = $input.val().trim();

		if (e.which !== ENTER_KEY || !val) {
			return;
		}

		var todoInfo = {
			id: (new Date()).getTime(),
			title: val,
			completed: false
		};

		$input.val('');

		var todoItem = new TodoItem(todoInfo);

		$('#todo-list').append(todoItem.render());
	};

	// exports
	return AppView;
});

define (
	// Define dependencies
	'app',['AppView'],

	function(AppView) {
		var appView = new AppView($('#todoapp'));
});

